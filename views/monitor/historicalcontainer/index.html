{{ template "layout.html" . }}

{{ define "css" }}
	<link rel="stylesheet" href="/static/css/chart/chart.css">	
{{ end}}

{{ define "content" }}
	<div class="page-header">
		<h1>Historical Container Metric</h1>
	</div>	
	
	<div class="row">
		<div class="col-md-1 pull-right">
			<button class="btn btn-md btn-primary" onclick="$('#idWaitingPanel').modal('show');moduleMonitorHistoricalContainerIndex.parameter.clean();moduleMonitorHistoricalContainerIndex.parameter.query(moduleMonitorHistoricalContainerIndex.parameter);">Submit</button>
		</div>
		<div class="col-md-2 pull-right">
			<div class="input-group date" id="datetimepickerTo" >
				<input type="text" class="form-control" id="datetimepickerInputTo"/>
				<span class="input-group-addon">
					<span class="glyphicon glyphicon-calendar"></span>
				</span>
			</div>
		</div>
		<label class="col-md-0 pull-right" for="namespace">To:</label>
		<div class="col-md-2 pull-right">
			<div class="input-group date" id="datetimepickerFrom">
				<input type="text" class="form-control" id="datetimepickerInputFrom"/>
				<span class="input-group-addon">
					<span class="glyphicon glyphicon-calendar"></span>
				</span>
			</div>
		</div>
		<label class="col-md-0 pull-right" for="namespace">From:</label>
		<div class="col-md-2 pull-right">
			<select id="replicationControllerName" class="form-control" 
				onchange="$('#idWaitingPanel').modal('show');moduleMonitorHistoricalContainerIndex.parameter.replicationControllerName=$('#replicationControllerName').val();
				moduleMonitorHistoricalContainerIndex.parameter.query(moduleMonitorHistoricalContainerIndex.parameter);">
			{{ range $replicationControllerNameKey, $replicationControllerName := .replicationControllerNameSlice}}
				<option value="{{$replicationControllerName}}">{{$replicationControllerName}}</option>
			{{ end }}
			</select>
		</div>
		<label class="col-md-0 pull-right" for="replicationControllerName">Replication Controller:</label>
	</div>

	<br/>
	
	<!-- Nav tabs -->
	<ul class="nav nav-tabs" role="tablist">
		<li role="presentation" class="active"><a href="#cpuUsageTotal" aria-controls="cpuUsageTotal" role="tab" data-toggle="tab">CPU</a></li>
		<li role="presentation"><a href="#memoryUsage" aria-controls="memoryUsage" role="tab" data-toggle="tab">Memory</a></li>
		<li role="presentation"><a href="#diskIOServiceBytesStats" aria-controls="diskIOServiceBytesStats" role="tab" data-toggle="tab">Disk I/O (Bytes)</a></li>
		<li role="presentation"><a href="#diskIOServicedStats" aria-controls="diskIOServicedStats" role="tab" data-toggle="tab">Disk I/O (Counts)</a></li>
		<!--
		<li role="presentation"><a href="#networkRXBytes" aria-controls="networkRXBytes" role="tab" data-toggle="tab">Network RX (Bytes)</a></li>
		<li role="presentation"><a href="#networkTXBytes" aria-controls="networkTXBytes" role="tab" data-toggle="tab">Network TX (Bytes)</a></li>
		<li role="presentation"><a href="#networkRXPackets" aria-controls="networkRXPackets" role="tab" data-toggle="tab">Network RX (Packets)</a></li>
		<li role="presentation"><a href="#networkTXPackets" aria-controls="networkTXPackets" role="tab" data-toggle="tab">Network TX (Packets)</a></li>
		-->
	</ul>

	<!-- Tab panes -->
	<div class="tab-content">
		<div role="tabpanel" class="tab-pane active" id="cpuUsageTotal">
			<div id="idChartCpuUsageTotal" class=""></div>
		</div>
		<div role="tabpanel" class="tab-pane" id="memoryUsage">
			<div id="idChartMemoryUsage" class=""></div>
		</div>
		<div role="tabpanel" class="tab-pane" id="diskIOServiceBytesStats">
			<div id="idChartDiskIOServiceBytesStats" class=""></div>
		</div>
		<div role="tabpanel" class="tab-pane" id="diskIOServicedStats">
			<div id="idChartDiskIOServicedStats" class=""></div>
		</div>
		<!--
		<div role="tabpanel" class="tab-pane" id="networkRXBytes">
			<div id="idChartNetworkRXBytes" class=""></div>
		</div>
		<div role="tabpanel" class="tab-pane" id="networkTXBytes">
			<div id="idChartNetworkTXBytes" class=""></div>
		</div>
		<div role="tabpanel" class="tab-pane" id="networkRXPackets">
			<div id="idChartNetworkRXPackets" class=""></div>
		</div>
		<div role="tabpanel" class="tab-pane" id="networkTXPackets">
			<div id="idChartNetworkTXPackets" class=""></div>
		</div>
		-->
	</div>

{{ end }}

{{ define "js" }}
	<script type="text/javascript" src="/static/js/chart/chart.js"></script>
	
	<script type="text/javascript">

	var moduleMonitorHistoricalContainerIndex = (function(){
		
		var parameter = {
			replicationControllerName: "",
			intervalInMilliSecond: 1000,
		}
		
		var clean = function () {
			$("#idChartCpuUsageTotal").empty();
			$("#idChartMemoryUsage").empty();
			$("#idChartDiskIOServiceBytesStats").empty();
			$("#idChartDiskIOServicedStats").empty();
			/*
			$("#idChartNetworkRXBytes").empty();
			$("#idChartNetworkTXBytes").empty();
			$("#idChartNetworkRXPackets").empty();
			$("#idChartNetworkTXPackets").empty();
			*/
		};
		parameter.clean = clean;
		
		var query = function(parameter) {
			var to = $('#datetimepickerInputTo').val();
			var from = $('#datetimepickerInputFrom').val();

			$.ajax({
				url: "{{.cloudoneGUIProtocol}}://{{.cloudoneGUIHost}}:{{.cloudoneGUIPort}}/gui/monitor/historicalcontainer/data?replicationController=" + parameter.replicationControllerName + "&from=" + from + "&to=" + to,
				type:"GET",
				dataType:'json',
				success: function(returnedData){
					$('#idWaitingPanel').modal('hide');
					
					if (returnedData.error != null || returnedData.warning != null ) {
						if (returnedData.warning != null) {
							$("#messageDisplay").empty();
							$("#messageDisplay").append('<p class="bg-warning">' + returnedData.warning + '</p>')
						} else if (returnedData.error != null) {
							$("#messageDisplay").empty();
							$("#messageDisplay").append('<p class="bg-danger">' + returnedData.error + '</p>')
						}
						parameter.clean();
					} else {
						$("#messageDisplay").empty();
						
						moduleTimeSeriesChart.draw(
							"#idChartCpuUsageTotal",
							returnedData.cpuUsageTotal.metadata,
							returnedData.cpuUsageTotal.data);
						moduleTimeSeriesChart.draw(
							"#idChartMemoryUsage",
							returnedData.memoryUsage.metadata,
							returnedData.memoryUsage.data);
						moduleTimeSeriesChart.draw(
							"#idChartDiskIOServiceBytesStats",
							returnedData.diskIOServiceBytesStats.metadata,
							returnedData.diskIOServiceBytesStats.data);
						moduleTimeSeriesChart.draw(
							"#idChartDiskIOServicedStats",
							returnedData.diskIOServicedStats.metadata,
							returnedData.diskIOServicedStats.data);
						/*
						moduleTimeSeriesChart.draw(
							"#idChartNetworkRXBytes",
							returnedData.networkRXBytes.metadata,
							returnedData.networkRXBytes.data);
						moduleTimeSeriesChart.draw(
							"#idChartNetworkTXBytes",
							returnedData.networkTXBytes.metadata,
							returnedData.networkTXBytes.data);
						moduleTimeSeriesChart.draw(
							"#idChartNetworkRXPackets",
							returnedData.networkRXPackets.metadata,
							returnedData.networkRXPackets.data);
						moduleTimeSeriesChart.draw(
							"#idChartNetworkTXPackets",
							returnedData.networkTXPackets.metadata,
							returnedData.networkTXPackets.data);
						*/
					}
				},
				error:function(xhr, ajaxOptions, thrownError){
					$('#idWaitingPanel').modal('hide');
				
					$("#messageDisplay").empty();
					$("#messageDisplay").append('<p class="bg-danger">' + thrownError + '</p>')
						
					//clearInterval(parameter.timer);
					//alert(xhr.status); 
					//alert(ajaxOptions); 
					//alert(thrownError); 
				}
			});
		};
		parameter.query = query;

		//var timer = setInterval(parameter.query, parameter.intervalInMilliSecond, parameter);
		//parameter.timer = timer;	

		//query(parameter);
		
		$('#datetimepickerFrom').datetimepicker();
		$('#datetimepickerTo').datetimepicker();
		

		
		return {
			parameter: parameter,
		};
	})();

	</script>
{{ end}}