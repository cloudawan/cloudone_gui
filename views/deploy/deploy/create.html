{{ template "layout.html" . }}

{{ define "css" }}
{{ end}}

{{ define "content" }}
	<div class="page-header">
		<h1>First Deploy</h1>
	</div>
	<div class="row">
		<div class="col-md-9">	
			<form class="form-horizontal" onsubmit="$('#idWaitingPanel').modal({backdrop: 'static'});" action="/gui/deploy/deploy/create" method="post">

				<div class="form-group">
					<label class="col-md-3 control-label" for="imageInformationName">Image Information:</label>
					<div class="col-md-9">
						<input id="imageInformationName" class="form-control" type="text" name="imageInformationName" value="{{ .imageInformationName }}" readonly="readonly">
					</div>
				</div>
				<div class="form-group">
					<label class="col-md-3 control-label" for="version">Version:</label>
					<div class="col-md-9">
						<select id="version" class="form-control" name="version" onchange="moduleDeployDeployCreate.hideAll();moduleDeployDeployCreate.show(this.value);">
							{{ range $imageRecordKey, $imageRecord := .imageRecordSlice}}
							<option value="{{ $imageRecord.Version }}">{{ $imageRecord.Version }} {{ $imageRecord.Description }}</option>
							{{end}}
						</select>
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-md-3 control-label" for="description">Description:</label>
					<div class="col-md-9">
						<input id="description" class="form-control" type="text" name="description">
					</div>
				</div>
				<div class="form-group">
					<label class="col-md-3 control-label" for="replicaAmount">Replica Amount:</label>
					<div class="col-md-9">
						<input id="replicaAmount" class="form-control" type="number" name="replicaAmount" value="1" min="1" max="10">
					</div>
				</div>
				<div class="form-group">
					<label class="col-md-3 control-label" for="containerPort">Container Port:</label>
					<div class="col-md-9">
						<input id="containerPort" class="form-control" type="number" name="containerPort" value="" min="1000" max="65535" required>
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-3 control-label" for="useNodePort">Use Node Port:</label>
					<div class="col-md-offset-1 col-md-6 checkbox">
						<input id="useNodePort" type="checkbox" name="useNodePort" onclick="$('#regionNodePort').toggle();">
					</div>
				</div>

				<div id="regionNodePort" hidden>
					<div class="form-group" >
						<label class="col-md-3 control-label" for="autoGeneratedNodePort">Auto Generated Node Port:</label>
						<div class="col-md-offset-1 col-md-6 checkbox">
							<input id="autoGeneratedNodePort" type="checkbox" name="autoGeneratedNodePort" onclick="$('#formGroupNodePort').toggle();">
						</div>
					</div>
					<div class="form-group" id="formGroupNodePort">
						<label class="col-md-3 control-label" for="nodePort">Node Port:</label>
						<div class="col-md-9">
							<input id="nodePort" class="form-control" type="number" name="nodePort" value="" min="30000" max="32767">
						</div>
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-md-3 control-label" >Environment Value:</label>
				</div>
				
				{{ range $imageRecordKey, $imageRecord := .imageRecordSlice}}
				<div id="{{ $imageRecord.Version }}_specific">
					{{ range $environment, $description := $imageRecord.Environment}}
					<div class="form-group">
						<label class="col-md-3 control-label" for="{{ $imageRecord.Version }}_{{ $environment }}">{{ $environment }}:</label>
						<div class="col-md-9">
							<input id="{{ $imageRecord.Version }}_{{ $environment }}" class="form-control" type="text" name="{{ $imageRecord.Version }}_{{ $environment }}">
						</div>
					</div>
					{{end}}
				</div>
				{{end}}

				<a class="btn btn-md btn-warning pull-right" onclick="$('#idWaitingPanel').modal({backdrop: 'static'});" href="/gui/repository/imageinformation/list">Cancel</a>
				<input class="btn btn-md btn-success pull-right" type="submit" value="Deploy">
			</form>
		</div>
	</div>
{{ end }}

{{ define "js" }}
	<script type="text/javascript">

	var moduleDeployDeployCreate = (function(){
		
		var hideAll = function() {
			{{ range $imageRecordKey, $imageRecord := .imageRecordSlice}}
			$("#{{ $imageRecord.Version }}_specific").hide()
			{{end}}
		}
		
		var show = function(version) {
			$("#" + version + "_specific").show()
		}
		
		hideAll();
		show($("#version").val());
		
		return {
			hideAll: hideAll,
			show: show,
		};
	})();

	</script>
{{ end}}